(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-user-chat-user-chat"],{"0649":function(t,e,n){"use strict";n.r(e);var r=n("1c62"),i=n("2070");for(var a in i)"default"!==a&&function(t){n.d(e,t,(function(){return i[t]}))}(a);var o,u=n("f0c5"),s=Object(u["a"])(i["default"],r["b"],r["c"],!1,null,"d7c060da",null,!1,r["a"],o);e["default"]=s.exports},1187:function(t,e,n){"use strict";n.r(e);var r=n("dce7"),i=n("9649");for(var a in i)"default"!==a&&function(t){n.d(e,t,(function(){return i[t]}))}(a);var o,u=n("f0c5"),s=Object(u["a"])(i["default"],r["b"],r["c"],!1,null,"2f977094",null,!1,r["a"],o);e["default"]=s.exports},"1c62":function(t,e,n){"use strict";var r,i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",[n("v-uni-scroll-view",{staticStyle:{position:"absolute",left:"0",top:"0",right:"0",bottom:"100rpx","background-color":"#f1f1f1"},attrs:{"scroll-y":"true","scroll-into-view":t.scrollInto,"scroll-with-animation":!0}},[t._l(t.list,(function(e,r){return[n("v-uni-view",{key:r+"_0",attrs:{id:"chat"+r}},[n("user-chat-list",{attrs:{item:e,index:r,pretime:r>0?t.list[r-1].create_time:0}})],1)]}))],2),n("bottom-input",{on:{submit:function(e){arguments[0]=e=t.$handleEvent(e),t.submit.apply(void 0,arguments)}}})],1)},a=[];n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return r}))},2070:function(t,e,n){"use strict";n.r(e);var r=n("88d3"),i=n.n(r);for(var a in r)"default"!==a&&function(t){n.d(e,t,(function(){return r[t]}))}(a);e["default"]=i.a},4096:function(t,e,n){"use strict";n("d3b7"),n("e25e"),n("4d63"),n("ac1f"),n("25f0"),n("5319"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r={getHoroscope:function(t){var e=["摩羯","水瓶","双鱼","白羊","金牛","双子","巨蟹","狮子","处女","天秤","天蝎","射手","摩羯"];t=new Date(t);var n=t.getMonth()+1,r=t.getDate(),i=n-(r-14<"865778999988".charAt(n));return e[i]+"座"},sumAge:function(t){var e=new Date(t.replace(/-/g,"/")),n=new Date,r=n.getTime()-e.getTime(),i=Math.floor(r/864e5),a=r%864e5,o=Math.floor(a/36e5),u=a%36e5,s=(Math.floor(u/6e4),u%6e4);Math.round(s/1e3);return i+"天 "+o+"小时 "},getChatTime:function(t,e){if(t=t.toString().length<13?1e3*t:t,e=e.toString().length<13?1e3*e:e,(parseInt(t)-parseInt(e))/1e3>300)return this.gettime(t)},gettime:function(t){t=t<1e12?1e3*t:t;var e=(new Date).getTime(),n=(e-parseInt(t))/1e3;return n<43200?this.dateFormat(new Date(t),"{A} {t}:{ii}"):n<518400?this.dateFormat(new Date(t),"{Mon}月{DD}日 {A} {t}:{ii}"):this.dateFormat(new Date(t),"{Y}-{MM}-{DD} {A} {t}:{ii}")},parseNumber:function(t){return t<10?"0"+t:t},dateFormat:function(t,e){var n={},r=/\{([^}]+)\}/,i=["1","2","3","4","5","6","7","8","9","10","11","12"];n["Y"]=t.getFullYear(),n["M"]=t.getMonth()+1,n["MM"]=this.parseNumber(n["M"]),n["Mon"]=i[n["M"]-1],n["D"]=t.getDate(),n["DD"]=this.parseNumber(n["D"]),n["h"]=t.getHours(),n["hh"]=this.parseNumber(n["h"]),n["t"]=n["h"]>12?n["h"]-12:n["h"],n["tt"]=this.parseNumber(n["t"]),n["A"]=n["h"]>12?"下午":"上午",n["i"]=t.getMinutes(),n["ii"]=this.parseNumber(n["i"]),n["s"]=t.getSeconds(),n["ss"]=this.parseNumber(n["s"]);while(r.test(e))e=e.replace(r,n[RegExp.$1]);return e},getAgeByBirthday:function(t){var e=new Date(t.replace(/-/g,"/")),n=new Date;return n.getFullYear()-e.getFullYear()-(n.getMonth()<e.getMonth()||n.getMonth()==e.getMonth()&&n.getDate()<e.getDate()?1:0)}};e.default=r},"6b86":function(t,e,n){"use strict";n.r(e);var r=n("aba4"),i=n("97b6");for(var a in i)"default"!==a&&function(t){n.d(e,t,(function(){return i[t]}))}(a);var o,u=n("f0c5"),s=Object(u["a"])(i["default"],r["b"],r["c"],!1,null,"1993f5c9",null,!1,r["a"],o);e["default"]=s.exports},"88d3":function(t,e,n){"use strict";var r=n("ee27");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,n("96cf");var i=r(n("c964")),a=r(n("6b86")),o=r(n("1187")),u={components:{userChatList:a.default,bottomInput:o.default},data:function(){return{scrollInto:"",list:[]}},onLoad:function(t){var e=this;if(!t.user)return uni.navigateBack({delta:1}),uni.showToast({title:"聊天对象不存在",icon:"none"});var n=JSON.parse(t.user);this.$store.commit("createToUser",n),this.$store.dispatch("getChatDetailToUser").then((function(t){console.log("[user-chat]获取当前聊天对象的聊天记录",t),e.list=t})),uni.$on("UserChat",(function(t){t.mime.id===n.id&&e.renderPage({data:t,send:!1})}))},onReady:function(){this.pageToBottom()},beforeDestroy:function(){this.$store.commit("closeToUser"),uni.$off("UserChat",(function(){}))},methods:{renderPage:function(t){var e=this;this.$store.dispatch("formatChatDetailObject",t).then((function(t){e.list.push(t),e.pageToBottom()}))},submit:function(t){var e=this;return(0,i.default)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.$store.dispatch("sendChatMessage",{data:t,type:e.$C.msgCTypeText});case 2:r=n.sent,e.renderPage({data:r,send:!0});case 4:case"end":return n.stop()}}),n)})))()},pageToBottom:function(){var t=this;setTimeout((function(){var e=t.list.length-1;e<0||(t.scrollInto="chat"+e)}),300)}}};e.default=u},"88e6":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r={props:{focus:{type:Boolean,default:!1}},data:function(){return{content:""}},methods:{submit:function(){if(""===this.content)return uni.showToast({title:"消息不能为空",icon:"none"});this.$emit("submit",this.content),this.content=""}}};e.default=r},9649:function(t,e,n){"use strict";n.r(e);var r=n("88e6"),i=n.n(r);for(var a in r)"default"!==a&&function(t){n.d(e,t,(function(){return r[t]}))}(a);e["default"]=i.a},"97b6":function(t,e,n){"use strict";n.r(e);var r=n("b2b2"),i=n.n(r);for(var a in r)"default"!==a&&function(t){n.d(e,t,(function(){return r[t]}))}(a);e["default"]=i.a},aba4:function(t,e,n){"use strict";var r,i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",[t.shortTime?n("v-uni-view",{staticClass:"py-2 flex align-center justify-center font-sm text-light-muted"},[t._v(t._s(t.shortTime))]):t._e(),n("v-uni-view",{staticClass:"flex align-start px-2 my-2",style:t.isSelf?"flex-direction: row-reverse;":""},[n("v-uni-image",{staticClass:"rounded-circle bg-secondary",staticStyle:{width:"100rpx",height:"100rpx"},attrs:{src:t.item.avatar?t.item.avatar:"/static/default.jpg"}}),n("v-uni-view",{staticClass:"bg-light p-2 mx-2",style:"border-radius: 15rpx;max-width: 400rpx;margin-top:5rpx;background-color:"+t.bgColor},[t._v(t._s(t.item.data))])],1)],1)},a=[];n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return r}))},b2b2:function(t,e,n){"use strict";var r=n("ee27");n("a9e3"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=r(n("4096")),a={props:{item:Object,index:Number,pretime:[Number,String]},computed:{isSelf:function(){var t=this.$store.state.user.user_id;return t===this.item.user_id},shortTime:function(){return i.default.getChatTime(this.item.create_time,this.pretime)},bgColor:function(){return this.$store.state.user.user_id===this.item.user_id?"#FFFFFF":"#6bee68"}}};e.default=a},dce7:function(t,e,n){"use strict";var r,i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",{staticClass:"fixed-bottom flex align-center border-top bg-white",staticStyle:{height:"100rpx"}},[n("v-uni-input",{staticClass:"flex-1 rounded bg-light ml-2",staticStyle:{padding:"5rpx"},attrs:{type:"text",focus:t.focus,placeholder:"文明发言"},on:{confirm:function(e){arguments[0]=e=t.$handleEvent(e),t.submit.apply(void 0,arguments)},blur:function(e){arguments[0]=e=t.$handleEvent(e),t.$emit("blur")}},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}}),n("v-uni-view",{staticClass:"iconfont icon-fabu flex align-center justify-center font-lg animated",staticStyle:{width:"100rpx"},attrs:{"hover-class":"jello text-main"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.submit.apply(void 0,arguments)}}})],1)},a=[];n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return r}))}}]);